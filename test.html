<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>tracking.js - first tracking</title>
    <script src="./lib/tracking.js-master/build/tracking.js"></script>
    <style>
      #video {
        position: absolute;
        top: -1000px;
      }

      #canvas {
        left: 50%;
        top: 50%;
        margin-left: -200px;
        margin-top: -150px;
        position: absolute;
      }
    </style>
  </head>
  <body>
    <!-- <video -->
    <!--   id="myVideo" -->
    <!--   width="400" -->
    <!--   height="300" -->
    <!--   preload -->
    <!--   autoplay -->
    <!--   loop -->
    <!--   muted -->
    <!-- ></video> -->

    <video
      id="myVideo"
      width="400"
      height="300"
      preload
      autoplay
      loop
      muted
    ></video>
    <canvas id="canvas" width="400" height="300"></canvas>

    <script>
      var canvas = document.getElementById("canvas");
      var context = canvas.getContext("2d");

      var video = document.querySelector("#myVideo");

      //if (navigator.mediaDevices.getUserMedia) {
      //  navigator.mediaDevices
      //    .getUserMedia({ video: true })
      //    .then(function (stream) {
      //      video.srcObject = stream;
      //    })
      //    .catch(function (err0r) {
      //      console.log("Something went wrong!");
      //    });
      //}
      var FastTracker = function () {
        FastTracker.base(this, "constructor");
      };
      tracking.inherits(FastTracker, tracking.Tracker);

      tracking.Fast.THRESHOLD = 30;
      FastTracker.prototype.threshold = tracking.Fast.THRESHOLD;

      FastTracker.prototype.track = function (pixels, width, height) {
        var gray = tracking.Image.grayscale(pixels, width, height);
        var corners = tracking.Fast.findCorners(gray, width, height);

        this.emit("track", {
          data: corners,
        });
      };

      var tracker = new FastTracker();

      let i = 0;
      let buildLog = (d) => {
        let l = [];
        for (let j = 0; j < d.length; j += 2) {
          l.push([d[j], d[j + 1]]);
        }
        console.log(l);
      };
      tracker.on("track", function (event) {
        i++;
        context.clearRect(0, 0, canvas.width, canvas.height);
        var corners = event.data;
        for (var i = 0; i < corners.length; i += 2) {
          context.fillStyle = "#f00";
          context.fillRect(corners[i], corners[i + 1], 2, 2);
        }
        if (i % 100 == 0) buildLog(event.data);
      });

      tracking.track("#myVideo", tracker, { camera: true });

      // GUI Controllers
    </script>
  </body>
</html>
